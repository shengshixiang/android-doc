<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>victor</title>

      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js?v=4339353d"></script>
        <script src="../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../../../_static/translations.js?v=beaddf03"></script>
        <script src="../../../../_static/js/baidutongji.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            victor_文档
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">README</a></li>
<li><a class="reference internal" href="#logcat">捉取开机的logcat</a></li>
<li><a class="reference internal" href="#kernel-log">捉取kernel log</a></li>
<li><a class="reference internal" href="#radio-log">捉取radio log</a></li>
<li><a class="reference internal" href="#android-c-log">android c++ log</a></li>
<li><a class="reference internal" href="#androidaloge">android使用ALOGE方法</a></li>
<li><a class="reference internal" href="#id1">修改kernel log串口 输出级别</a></li>
<li><a class="reference internal" href="#android-log">捉取android 的详细log</a><ul>
<li><a class="reference internal" href="#id2">具体命令如下</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kernel-dmesg-kmsg">kernel dmesg 与 kmsg区别</a></li>
<li><a class="reference internal" href="#pr-info-log">pr_info log解析</a></li>
<li><a class="reference internal" href="#id3">Android log分析</a></li>
<li><a class="reference internal" href="#qxdm-log-log">捉高通qxdm log, 捉log</a></li>
<li><a class="reference internal" href="#log-ndebug">LOG_NDEBUG</a></li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">victor_文档</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs"> 
<li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
<li>README</li>
<li style="float: right;margin-left: 10px;"><a href="javascript:history.forward()">Forward</a></li>
<li style="float: right;margin-left: 10px;"><a href="javascript:history.back()">Go Back</a> | </li>
<li style="float: right;margin-left: 10px;"><a href="/index.html">Home</a> | </li>

      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="readme">
<h1>README<a class="headerlink" href="#readme" title="此标题的永久链接"></a></h1>
<p>android包括 kernel的一些log输出技巧</p>
</section>
<section id="logcat">
<h1>捉取开机的logcat<a class="headerlink" href="#logcat" title="此标题的永久链接"></a></h1>
<ul class="simple">
<li><p>adb wait-for-device &amp;&amp; adb logcat &gt; 1.txt</p></li>
</ul>
</section>
<section id="kernel-log">
<h1>捉取kernel log<a class="headerlink" href="#kernel-log" title="此标题的永久链接"></a></h1>
<ul class="simple">
<li><p>adb logcat -b kernel &gt; kernel.log</p></li>
<li><p>adb shell dmesg &gt; dmesg.log</p></li>
</ul>
</section>
<section id="radio-log">
<h1>捉取radio log<a class="headerlink" href="#radio-log" title="此标题的永久链接"></a></h1>
<ul class="simple">
<li><p>adb shell logcat -b radio</p></li>
</ul>
<p>搜索CellSignalStrengthLte 判断信号强度</p>
<ul class="simple">
<li><p>高通的logkit 默认没有打开radio log,需要在config里面打开radio log</p></li>
<li><p>logcat event 也需要在Logkit的config 打开</p></li>
</ul>
</section>
<section id="android-c-log">
<h1>android c++ log<a class="headerlink" href="#android-c-log" title="此标题的永久链接"></a></h1>
<p>c++包含的LOG 文件,输出到logcat</p>
<ul class="simple">
<li><p>QSSI.12/system/libbase/include/android-base/logging.h</p></li>
</ul>
</section>
<section id="androidaloge">
<h1>android使用ALOGE方法<a class="headerlink" href="#androidaloge" title="此标题的永久链接"></a></h1>
<ul class="simple">
<li><p>Android.mk包含三个库</p>
<ul>
<li><p>LOCAL_SHARED_LIBRARIES:= libcutils libutils liblog</p></li>
</ul>
</li>
<li><p>c文件</p>
<ul>
<li><p>包含 #include &lt;utils/Log.h&gt;</p></li>
<li><p>#undef LOG_TAG</p></li>
<li><p>#define LOG_TAG “test”</p></li>
</ul>
</li>
</ul>
</section>
<section id="id1">
<h1>修改kernel log串口 输出级别<a class="headerlink" href="#id1" title="此标题的永久链接"></a></h1>
<ul class="simple">
<li><p>echo 8 &gt; /proc/sys/kernel/printk</p></li>
<li><p>adb shell cat /proc/sys/kernel/printk</p></li>
</ul>
</section>
<section id="android-log">
<h1>捉取android 的详细log<a class="headerlink" href="#android-log" title="此标题的永久链接"></a></h1>
<p>文件已上传files/allin1_log.bat</p>
<section id="id2">
<h2>具体命令如下<a class="headerlink" href="#id2" title="此标题的永久链接"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@echo off
::V2.0 2022-1-6 by oyx

::各个系统不同，可以根据需求添加或者删除不必要的目录下的数据获取

echo 版本号：Get Android All Log V2.0

echo 当前时间是：%time% 即 %time:~0,2%点%time:~3,2%分%time:~6,2%秒%time:~9,2%厘秒@

set date_time=&quot;%date:~0,4%%date:~5,2%%date:~8,2%_%time:~0,2%%time:~3,2%_%time:~6,2%%time:~9,2%&quot;
::设置显示的文件夹名称
set Folder=&quot;Logs_%date:~0,4%%date:~5,2%%date:~8,2%_%time:~0,2%%time:~3,2%_%time:~6,2%%time:~9,2%&quot;
echo 日志文件夹：%Folder%
md %Folder%

::获取root权限，下面pull一些隐私目录的数据需要root权限
adb root
adb remount

::创建文件夹
md %Folder%\device
::获取系统的所有app服务
adb shell ps &gt; %Folder%\device\ps.txt
::获取系统的cup等占用情况
adb shell top  -n 1 &gt; %Folder%\device\top.txt
::获取系统的cup前十个占用最多的进程信息
adb shell top  -n 1 -H -m 10 -s cpu &gt; %Folder%\device\top2.txt
::获取系统的进程内核信息
adb shell cat /proc/cmdline &gt; %Folder%\device\cmdline.txt
::获取系统的进程内存占用信息
adb shell cat /proc/meminfo &gt; %Folder%\device\meminfo.txt
::获取系统的cpu信息
adb shell cat /proc/cpuinfo &gt; %Folder%\device\cpuinfo.txt
::获取系统的prop属性信息
adb shell getprop &gt; %Folder%\device\getprop.txt
::获取系统的内存大小信息
adb shell df -h &gt; %Folder%\device\df.txt
::获取网络信息
adb shell ifconfig -a &gt; %Folder%\device\network.txt
::获取ko
adb shell lsmod &gt; %Folder%\device\lsmod.txt

::获取系统的当前界面截图
adb shell screencap /mnt/sdcard/Pictures/screen_0.png
adb shell &quot;screencap -p -d 1 &gt; /sdcard/screen_1.png&quot;
adb pull /mnt/sdcard/Pictures/screen_0.png %Folder%\screen_0.png
adb pull /mnt/sdcard/Pictures/screen_1.png %Folder%\screen_1.png

::获取系统的dumpsys信息，包含dumpsys package XXX的信息
md %Folder%\dumpsys
adb shell dumpsys &gt; %Folder%\dumpsys\dumpsys.txt

::获取系统的缓存日志
adb shell  logcat -b all -v threadtime -d &gt; %Folder%\logcat_all.txt
adb shell  logcat -v threadtime -d &gt; %Folder%\logcat.txt
adb shell bugreport &gt; %Folder%\bugreport.txt

::获取内核日志
adb shell dmesg &gt; %Folder%\kernel.txt
adb shell &quot;echo t &gt; /proc/sysrq-trigger&quot;
adb shell dmesg &gt; %Folder%\kernel_t.txt

::获取系统的各目录下的日志，根据不同系统进适配

::系统Android日志
adb pull   /data/log/android_logs       %Folder%\android_logs
::Dalvik、状态监视调试器、C层代码以及libc的一些问题导致的错误日志
adb pull   /data/tombstones             %Folder%\tombstones
::系统ANR异常日志
adb pull   /data/anr                    %Folder%\anr
::系统内核日志
adb pull   /sys/fs/pstore               %Folder%\pstore
::系统内核应用程序崩溃数据
adb pull   /data/system/dropbox         %Folder%\dropbox
::系统日志
adb pull   /data/log/reliability        %Folder%\reliability_system
adb pull   /data/vendor/log/reliability %Folder%\reliability_vendor
::系统settings下的system、secure、global等属性
adb pull /data/system/users/0           %Folder%\settings

::获取系统的recovery信息
adb pull /cache/recovery %Folder%\

echo.
echo ==========log抓取完成==========
pause
</pre></div>
</div>
</section>
</section>
<section id="kernel-dmesg-kmsg">
<h1>kernel dmesg 与 kmsg区别<a class="headerlink" href="#kernel-dmesg-kmsg" title="此标题的永久链接"></a></h1>
<p>dmesg 打印内核启动过程的所有信息,/proc/kmsg也是打印内核的信息</p>
<p>但是与dmesg 有不同， 第一次执行/proc/kmsg 打印到目前位置的所有内核信息，再次执行/proc/kmsg,</p>
<p>不打印打印过了的信息，打印第一次执行之后的信息，下面举个例子：</p>
<p>第一次执行dmesg打印：</p>
<p>A</p>
<p>B</p>
<p>C</p>
<p>第一次执行/proc/kmsg打印：</p>
<p>A</p>
<p>B</p>
<p>C</p>
<p>第二次执行dmesg打印：</p>
<p>A</p>
<p>B</p>
<p>C</p>
<p>D</p>
<p>第2次执行/proc/kmsg打印：</p>
<p>D</p>
<p>依次类推。</p>
</section>
<section id="pr-info-log">
<h1>pr_info log解析<a class="headerlink" href="#pr-info-log" title="此标题的永久链接"></a></h1>
<ul class="simple">
<li><p>UM.9.15/kernel/msm-4.19/include/linux/printk.h</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="c1">#define pr_emerg(fmt, ...) \</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_EMERG</span> <span class="n">pr_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>

<span class="c1">#define pr_alert(fmt, ...) \</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="n">pr_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>

<span class="c1">#define pr_crit(fmt, ...) \</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_CRIT</span> <span class="n">pr_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>

<span class="c1">#define pr_err(fmt, ...) \</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="n">pr_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>

<span class="c1">#define pr_warning(fmt, ...) \</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span> <span class="n">pr_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>

<span class="c1">#define pr_warn pr_warning</span>

<span class="c1">#define pr_notice(fmt, ...) \</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_NOTICE</span> <span class="n">pr_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>

<span class="c1">#define pr_info(fmt, ...) \</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="n">pr_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>

<span class="c1">#define pr_cont(fmt, ...) \</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_CONT</span> <span class="n">fmt</span><span class="p">,</span> <span class="c1">##__VA_ARGS__)</span>

<span class="c1">#define pr_debug(fmt, ...) \</span>
    <span class="n">dynamic_pr_debug</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="c1">##__VA_ARGS__)</span>
<span class="c1">#elif defined(DEBUG)</span>
<span class="c1">#define pr_debug(fmt, ...) \</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="n">pr_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>
<span class="c1">#else</span>
<span class="c1">#define pr_debug(fmt, ...) \</span>
    <span class="n">no_printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="n">pr_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>
<span class="c1">#endif</span>

</pre></div>
</div>
<ul class="simple">
<li><p>UM.9.15/kernel/msm-4.19/include/linux/device.h</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define dev_emerg(dev, fmt, ...)                    \</span>
    <span class="n">_dev_emerg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">dev_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>
<span class="c1">#define dev_crit(dev, fmt, ...)                     \</span>
    <span class="n">_dev_crit</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">dev_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>
<span class="c1">#define dev_alert(dev, fmt, ...)                    \</span>
    <span class="n">_dev_alert</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">dev_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>
<span class="c1">#define dev_err(dev, fmt, ...)                      \</span>
    <span class="n">_dev_err</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">dev_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>
<span class="c1">#define dev_warn(dev, fmt, ...)                     \</span>
    <span class="n">_dev_warn</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">dev_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>
<span class="c1">#define dev_notice(dev, fmt, ...)                   \</span>
    <span class="n">_dev_notice</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">dev_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>
<span class="c1">#define dev_info(dev, fmt, ...)                     \</span>
    <span class="n">_dev_info</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">dev_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>

<span class="c1">#if defined(CONFIG_DYNAMIC_DEBUG)</span>
<span class="c1">#define dev_dbg(dev, fmt, ...)                      \</span>
    <span class="n">dynamic_dev_dbg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">dev_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>
<span class="c1">#elif defined(DEBUG)</span>
<span class="c1">#define dev_dbg(dev, fmt, ...)                      \</span>
    <span class="n">dev_printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span><span class="p">,</span> <span class="n">dev</span><span class="p">,</span> <span class="n">dev_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>
<span class="c1">#else</span>
<span class="c1">#define dev_dbg(dev, fmt, ...)                      \</span>
<span class="p">({</span>                                  \
    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>                              \
        <span class="n">dev_printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span><span class="p">,</span> <span class="n">dev</span><span class="p">,</span> <span class="n">dev_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__); \</span>
<span class="p">})</span>
<span class="c1">#endif</span>
</pre></div>
</div>
<ul class="simple">
<li><p>UM.9.15/kernel/msm-4.19/include/linux/kern_levels.h</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="mi">5</span> <span class="c1">#define KERN_SOH    &quot;\001&quot;      /* ASCII Start Of Header */</span>
  <span class="mi">6</span> <span class="c1">#define KERN_SOH_ASCII  &#39;\001&#39;</span>
  <span class="mi">7</span> 
  <span class="mi">8</span> <span class="c1">#define KERN_EMERG  KERN_SOH &quot;0&quot;    /* system is unusable */</span>
  <span class="mi">9</span> <span class="c1">#define KERN_ALERT  KERN_SOH &quot;1&quot;    /* action must be taken immediately */</span>
 <span class="mi">10</span> <span class="c1">#define KERN_CRIT   KERN_SOH &quot;2&quot;    /* critical conditions */</span>
 <span class="mi">11</span> <span class="c1">#define KERN_ERR    KERN_SOH &quot;3&quot;    /* error conditions */</span>
 <span class="mi">12</span> <span class="c1">#define KERN_WARNING    KERN_SOH &quot;4&quot;    /* warning conditions */</span>
 <span class="mi">13</span> <span class="c1">#define KERN_NOTICE KERN_SOH &quot;5&quot;    /* normal but significant condition */</span>
 <span class="mi">14</span> <span class="c1">#define KERN_INFO   KERN_SOH &quot;6&quot;    /* informational */</span>
 <span class="mi">15</span> <span class="c1">#define KERN_DEBUG  KERN_SOH &quot;7&quot;    /* debug-level messages */</span>
</pre></div>
</div>
<ul class="simple">
<li><p>log打印分析</p>
<ul>
<li><p>probe的时候,串口log,adb logcat 都一样, pr_emerg,pr_alert,pr_crit,pr_err,pr_warn,pr_notice,pr_info,pr_cont,都有打印,pr_debug没有打印</p></li>
<li><p>cat /sys/pax_tp_gesture/tp_gesture 的时候,串口log pr_emerg,pr_alert,pr_crit,pr_err,都有打印,pr_warn以上没有打印,adb logcat 全部打印,除了pr_debug</p></li>
</ul>
</li>
</ul>
<p>证明probe的时候,pritk 优先级比较高,开完机才降低优先级</p>
<ul>
<li><p>默认值 /proc/sys/kernel/printk</p>
<p>4       6       1       7</p>
</li>
<li><p>/proc/sys/kernel/printk</p></li>
</ul>
<p>把他改成 6       6       1       7后, 串口log就输出了pr_notice,pr_warn,pr_err,pr_crit,pr_alert,pr_emerg 跟KERN_INFO 等级刚好对应</p>
<ul class="simple">
<li><p>pr_debug</p></li>
</ul>
<p>动态打印,可以看到默认值如下,没有打印出 pr_debug信息</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A6650</span><span class="p">:</span><span class="o">/</span> <span class="c1"># cat /sys/kernel/debug/dynamic_debug/control | grep  pax_tp_gesture</span>
<span class="n">drivers</span><span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">pax</span><span class="o">/</span><span class="n">pax_tp_gesture</span><span class="o">/</span><span class="n">pax_tp_gesture</span><span class="o">.</span><span class="n">c</span><span class="p">:</span><span class="mi">54</span> <span class="p">[</span><span class="n">pax_tp_gesture</span><span class="p">]</span><span class="n">tp_gesture_show</span> <span class="o">=</span><span class="n">_</span> <span class="s2">&quot;victor,pr_debug,begin</span><span class="se">\012</span><span class="s2">&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>echo “file pax_tp_gesture.c +p” &gt; /sys/kernel/debug/dynamic_debug/control</p></li>
</ul>
<p>输入这个命令后,动态log就打印出来了</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A6650</span><span class="p">:</span><span class="o">/</span> <span class="c1"># cat /sys/kernel/debug/dynamic_debug/control | grep  pax_tp_gesture</span>
<span class="n">drivers</span><span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">pax</span><span class="o">/</span><span class="n">pax_tp_gesture</span><span class="o">/</span><span class="n">pax_tp_gesture</span><span class="o">.</span><span class="n">c</span><span class="p">:</span><span class="mi">54</span> <span class="p">[</span><span class="n">pax_tp_gesture</span><span class="p">]</span><span class="n">tp_gesture_show</span> <span class="o">=</span><span class="n">p</span> <span class="s2">&quot;victor,pr_debug,begin</span><span class="se">\012</span><span class="s2">&quot;</span>

<span class="mi">04</span><span class="o">-</span><span class="mi">09</span> <span class="mi">18</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mf">28.594</span>     <span class="mi">0</span>     <span class="mi">0</span> <span class="n">D</span>         <span class="p">:</span> <span class="n">victor</span><span class="p">,</span><span class="n">pr_debug</span><span class="p">,</span><span class="n">begin</span>
</pre></div>
</div>
<ul class="simple">
<li><p>echo -n “file pax_tp_gesture.c +pfmlt” &gt; /sys/kernel/debug/dynamic_debug/control</p></li>
</ul>
<p>输入该命令后,pr_debug输出了,并且附带很多输出</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A6650</span><span class="p">:</span><span class="o">/</span> <span class="c1"># cat /sys/kernel/debug/dynamic_debug/control | grep  pax_tp_gesture</span>
<span class="n">drivers</span><span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">pax</span><span class="o">/</span><span class="n">pax_tp_gesture</span><span class="o">/</span><span class="n">pax_tp_gesture</span><span class="o">.</span><span class="n">c</span><span class="p">:</span><span class="mi">54</span> <span class="p">[</span><span class="n">pax_tp_gesture</span><span class="p">]</span><span class="n">tp_gesture_show</span> <span class="o">=</span><span class="n">pmflt</span> <span class="s2">&quot;victor,pr_debug,begin</span><span class="se">\012</span><span class="s2">&quot;</span>
<span class="n">A6650</span><span class="p">:</span><span class="o">/</span> <span class="c1">#</span>

<span class="mi">04</span><span class="o">-</span><span class="mi">09</span> <span class="mi">18</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mf">25.922</span>     <span class="mi">0</span>     <span class="mi">0</span> <span class="n">D</span> <span class="p">[</span><span class="mi">5077</span><span class="p">]</span> <span class="n">pax_tp_gesture</span><span class="p">:</span> <span class="n">tp_gesture_show</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span> <span class="n">victor</span><span class="p">,</span><span class="n">pr_debug</span><span class="p">,</span><span class="n">begin</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>* p,打印pr_debug

* f,表示把调用pr_debug的函数名也打印出来

* m,表示把模块名也打印出来；

* l,行号

* t,进程号
</pre></div>
</div>
<ul class="simple">
<li><p>echo -n “file pax_tp_gesture.c -pfmlt” &gt; /sys/kernel/debug/dynamic_debug/control</p></li>
</ul>
<p>代表删掉参数,不输出pr_debug</p>
<ul class="simple">
<li><p>user版本,dynamic_debug 宏没开,/sys/kernel/debug/dynamic_debug/control 目录没有</p></li>
</ul>
<p>可以mount 目录出来,但是验证失败,估计CONFIG_DEBUG_FS=y 没有定义</p>
<ul class="simple">
<li><p>定义DEBUG宏</p></li>
</ul>
<p>在需要打印dev_dbg调试信息的驱动文件开头定义DEBUG宏, 注意必须是在&lt;linux/device.h&gt; 或者&lt;linux/paltforam_device.h&gt;前面定义.</p>
<ul class="simple">
<li><p>pr_,与dev_的区别</p></li>
</ul>
<p>pr_err,dev_err 基本表现一致, logcat都有, 但是dev_dbg,跟pr_debug也要打开/sys/kernel/debug/dynamic_debug/control 才有</p>
<p>串口的pr_debug跟 dev_dbg 还要 设置/proc/sys/kernel/printk &gt;=8 才会出来</p>
<p>pr_info,dev_info等信息,probe的时候会打印</p>
<p>区别在于,dev_dbg 会把dev driver,跟devname,dts 的设备名字打出来,pr_err只会输出log</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="p">[</span>  <span class="mf">118.787070</span><span class="p">]</span> <span class="n">authinfoDriverName</span> <span class="n">soc</span><span class="p">:</span><span class="n">pax_authinfo_dts_1</span><span class="p">:</span> <span class="n">victor_dev</span><span class="p">,</span><span class="n">dev_emerg</span><span class="p">,</span><span class="n">authinfo_suspend</span>
<span class="p">[</span>  <span class="mf">118.787074</span><span class="p">]</span> <span class="n">victor_dev</span><span class="p">,</span><span class="n">pr_emerg</span><span class="p">,</span><span class="n">authinfo_suspend</span>
</pre></div>
</div>
<p>driver name就是authinfoDriverName,
dev name 就是 soc:pax_authinfo_dts</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">struct</span> <span class="n">platform_driver</span> <span class="n">authinfo_driver</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">.</span><span class="n">name</span>   <span class="o">=</span> <span class="s2">&quot;authinfoDriverName&quot;</span><span class="p">,</span>
        <span class="o">.</span><span class="n">owner</span>  <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
        <span class="o">.</span><span class="n">pm</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">authinfo_pm</span><span class="p">,</span>
        <span class="o">.</span><span class="n">of_match_table</span> <span class="o">=</span> <span class="n">authinfo_match_table</span><span class="p">,</span>
    <span class="p">},</span>   
    <span class="o">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">authinfo_probe</span><span class="p">,</span>
    <span class="o">.</span><span class="n">remove</span> <span class="o">=</span> <span class="n">authinfo_remove</span><span class="p">,</span>
    <span class="o">.</span><span class="n">shutdown</span> <span class="o">=</span> <span class="n">authinfo_shutdown</span><span class="p">,</span>
<span class="p">};</span>

<span class="o">&amp;</span><span class="n">soc</span> <span class="p">{</span>
 <span class="o">//</span> <span class="p">[</span><span class="n">FEATURE</span><span class="p">]</span><span class="o">-</span><span class="n">Add</span><span class="o">-</span><span class="n">BEGIN</span> <span class="n">by</span> <span class="n">xielianxiong</span><span class="nd">@paxsz</span><span class="o">.</span><span class="n">com</span><span class="p">,</span> <span class="mi">2022</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">15</span><span class="p">,</span> <span class="k">for</span> <span class="n">ap</span> <span class="n">sp</span> <span class="n">uart</span>
       <span class="n">pax_authinfo_dts_2</span><span class="p">:</span><span class="n">pax_authinfo_dts_1</span> <span class="p">{</span>
       <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define pr_err(fmt, ...) \</span>
<span class="mi">304</span>     <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="n">pr_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>

<span class="c1">#define dev_err(dev, fmt, ...)                      \</span>
<span class="mi">1548</span>     <span class="n">_dev_err</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">dev_fmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span> <span class="c1">##__VA_ARGS__)</span>

<span class="c1">#define define_dev_printk_level(func, kern_level)       \</span>
<span class="n">void</span> <span class="n">func</span><span class="p">(</span><span class="n">const</span> <span class="n">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>   \
<span class="p">{</span>                               \
    <span class="n">struct</span> <span class="n">va_format</span> <span class="n">vaf</span><span class="p">;</span>                   \
    <span class="n">va_list</span> <span class="n">args</span><span class="p">;</span>                       \
                                \
    <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>                    \
                                \
    <span class="n">vaf</span><span class="o">.</span><span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">;</span>                      \
    <span class="n">vaf</span><span class="o">.</span><span class="n">va</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">args</span><span class="p">;</span>                     \
                                \
    <span class="n">__dev_printk</span><span class="p">(</span><span class="n">kern_level</span><span class="p">,</span> <span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vaf</span><span class="p">);</span>            \
                                \
    <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>                       \
<span class="p">}</span>                               \
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">func</span><span class="p">);</span>

<span class="n">define_dev_printk_level</span><span class="p">(</span><span class="n">_dev_emerg</span><span class="p">,</span> <span class="n">KERN_EMERG</span><span class="p">);</span>
<span class="n">define_dev_printk_level</span><span class="p">(</span><span class="n">_dev_alert</span><span class="p">,</span> <span class="n">KERN_ALERT</span><span class="p">);</span>
<span class="n">define_dev_printk_level</span><span class="p">(</span><span class="n">_dev_crit</span><span class="p">,</span> <span class="n">KERN_CRIT</span><span class="p">);</span>
<span class="n">define_dev_printk_level</span><span class="p">(</span><span class="n">_dev_err</span><span class="p">,</span> <span class="n">KERN_ERR</span><span class="p">);</span>
<span class="n">define_dev_printk_level</span><span class="p">(</span><span class="n">_dev_warn</span><span class="p">,</span> <span class="n">KERN_WARNING</span><span class="p">);</span>
<span class="n">define_dev_printk_level</span><span class="p">(</span><span class="n">_dev_notice</span><span class="p">,</span> <span class="n">KERN_NOTICE</span><span class="p">);</span>
<span class="n">define_dev_printk_level</span><span class="p">(</span><span class="n">_dev_info</span><span class="p">,</span> <span class="n">KERN_INFO</span><span class="p">);</span>

<span class="c1">#endif</span>


<span class="n">static</span> <span class="n">void</span> <span class="n">__dev_printk</span><span class="p">(</span><span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">level</span><span class="p">,</span> <span class="n">const</span> <span class="n">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
            <span class="n">struct</span> <span class="n">va_format</span> <span class="o">*</span><span class="n">vaf</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="p">)</span>
        <span class="n">dev_printk_emit</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="n">dev</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">: %pV&quot;</span><span class="p">,</span>
                <span class="n">dev_driver_string</span><span class="p">(</span><span class="n">dev</span><span class="p">),</span> <span class="n">dev_name</span><span class="p">(</span><span class="n">dev</span><span class="p">),</span> <span class="n">vaf</span><span class="p">);</span>
    <span class="k">else</span> 
        <span class="n">printk</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(NULL device *): %pV&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">vaf</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id3">
<h1>Android log分析<a class="headerlink" href="#id3" title="此标题的永久链接"></a></h1>
<p>可以制作一个简单的自动化log分析工具</p>
<ul>
<li><p>崩溃</p>
<blockquote>
<div><p>搜索,Fatal &gt; Crash &gt; Android Runtime &gt; Shutting down VM &gt; Exception &gt; Error</p>
</div></blockquote>
</li>
<li><p>ANR</p>
<blockquote>
<div><p>搜索,timeout,Anr</p>
</div></blockquote>
</li>
<li><p>开机阶段</p>
<blockquote>
<div><p>搜索,Starting phase
PHASE_SYSTEM_SERVICE_READY</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="qxdm-log-log">
<h1>捉高通qxdm log, 捉log<a class="headerlink" href="#qxdm-log-log" title="此标题的永久链接"></a></h1>
<ul>
<li><p>push <a class="reference download internal" download="" href="../../../../_downloads/1c83cdc4d5fb87e021c39db7ed60736f/default_logmask.cfg"><span class="xref download myst">default_logmask.cfg</span></a> 到 /sdcard/diag_logs/</p>
<blockquote>
<div><p>adb root
adb shell mkdir /sdcard/diag_logs/
adb push default_logmask.cfg /sdcard/diag_logs/</p>
</div></blockquote>
</li>
<li><p>开始捉qxdm log</p>
<blockquote>
<div><p>diag_mdlog -f /sdcard/diag_logs/default_logmask.cfg -o /sdcard/diag_logs/ &amp;</p>
</div></blockquote>
</li>
<li><p>拉取log,*.qmdl log file</p>
<blockquote>
<div><p>adb pull /sdcard/diag_logs/ .</p>
</div></blockquote>
</li>
<li><p>使用高通qxdm分析log,一般都没有,需要license</p></li>
</ul>
</section>
<section id="log-ndebug">
<h1>LOG_NDEBUG<a class="headerlink" href="#log-ndebug" title="此标题的永久链接"></a></h1>
<p>在文件最top，定义 #define LOG_NDEBUG 0 ，可以输出 ALOGV,默认是关闭,</p>
<p>具体定义在 android/system/core/liblog/include/log/log.h</p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2022, victor。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
  

<script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
<script>LA.init({id: "JoV5csIHTGhHiGQ4",ck: "JoV5csIHTGhHiGQ4"})</script>

<br/>
<script id="LA-DATA-WIDGET" crossorigin="anonymous" charset="UTF-8" src="https://v6-widget.51.la/v6/JoV5csIHTGhHiGQ4/quote.js?theme=#4C8AC2,#BB2626,#040000,#333333,#AE3535,#1690FF,14&f=14"></script>



</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>